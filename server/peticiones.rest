@host = http://localhost:3000

### BASE PATHS
@urlHealth = /api/health
@urlSP     = /api/sp
@urlACC    = /api/acc
@urlAdmin  = /api/admin
@urlBridge = /api/bridge
@urlAudit  = /api/audit

### TENANT / IDs (ajusta a tu entorno)
@SPO_TENANT_HOST = labitgroup.sharepoint.com

@HUB_ID         = b.1bb899d4-8dd4-42d8-aefd-6c0e35acd825
@ACC_ACCOUNT_ID = 1bb899d4-8dd4-42d8-aefd-6c0e35acd825
@PROJECT_ID     = b.76947f01-cc26-47db-9681-fff27e5430ce

@SP_SITE_URL = https://{{SPO_TENANT_HOST}}/sites/LBAN0X
@SP_DRIVE_ID = b!DQOmTDWg4UCWLUzjVxfVHsgBQQSZtqtIhu-TIGdbQBu81Wu7u7k0S6njwic8UIS3
@SP_ITEM_ID  = 01KWI7RKN6Y2GOVW7725BZO354PWSELRRZ

@ACC_FOLDER_ID = urn:adsk.wipprod:fs.folder:co._HMyOfTySzGn6hpRrYrdvA

### ADMIN / TEMPLATES
@TEMPLATE_ID = labit-standard-v1
@CODE = 007
@NAME = Demo
@TWIN_ID = PRJ-001-DEMO

################################################################################
# HEALTH
################################################################################

GET {{host}}{{urlHealth}}

################################################################################
# SHAREPOINT (descubrimiento rápido)
################################################################################

### (SP) 0) Confirmar root del tenant
GET {{host}}{{urlSP}}/root

### (SP) 1) Buscar sitio por texto (displayName / url)
GET {{host}}{{urlSP}}/find-sites?q={{NAME}}

### (SP) 2) Listar drives de un sitio (por URL directa)
GET {{host}}{{urlSP}}/drives-by-url?url={{SP_SITE_URL}}

### (SP) 3) Resolver siteId desde URL
GET {{host}}{{urlSP}}/siteId?url={{SP_SITE_URL}}

### (SP) 4) Listar raíz de una biblioteca concreta
GET {{host}}{{urlSP}}/list?driveId={{SP_DRIVE_ID}}

### (SP) 5) Listar carpeta por path dentro del drive
GET {{host}}{{urlSP}}/list?driveId={{SP_DRIVE_ID}}&path=1_COMM

### Comprobacion de token correcto
GET {{host}}{{urlAdmin}}/sp/diag/tenant

### DIAG: buscar usuario exacto por correo
GET {{host}}{{urlAdmin}}/sp/diag/user?id=support@labit.es

### DIAG: listar por mail
GET {{host}}{{urlAdmin}}/sp/diag/users?email=support@labit.es

### DIAG: por nombre visible (plan B)
GET {{host}}{{urlAdmin}}/sp/diag/users?q=Support


################################################################################
# ACC (descubrimiento rápido)
################################################################################

### (ACC) 0) Hubs
GET {{host}}{{urlACC}}/hubs

### (ACC) 1) Proyectos del hub
GET {{host}}{{urlACC}}/projects?hubId={{HUB_ID}}&all=true&limit=200

### (ACC) 2) Top folders del proyecto
GET {{host}}{{urlACC}}/top-folders?hubId={{HUB_ID}}&projectId={{PROJECT_ID}}

### (ACC) 3) (opcional) Listar una carpeta
GET {{host}}{{urlACC}}/list?projectId={{PROJECT_ID}}&folderId={{ACC_FOLDER_ID}}&all=true&limit=200

################################################################################
# ADMIN · Templates
################################################################################

### Ver plantilla
GET {{host}}{{urlAdmin}}/templates/{{TEMPLATE_ID}}

################################################################################
# ADMIN · Apply SOLO ACC/SP
################################################################################

### (ACC) Aplicar plantilla en proyecto existente (canónico)
POST {{host}}{{urlAdmin}}/acc/apply
Content-Type: application/json

{
  "projectId": "{{PROJECT_ID}}",
  "templateId": "{{TEMPLATE_ID}}",
  "vars": { "code": "{{CODE}}", "name": "{{NAME}}" },
  "accountId": "{{ACC_ACCOUNT_ID}}"
}

# Legacy equivalente (si lo necesitas puntualmente):
# POST {{host}}{{urlAdmin}}/apply/acc

### (SP) Aplicar plantilla en sitio existente (canónico)
POST {{host}}{{urlAdmin}}/sp/sites/apply
Content-Type: application/json

{
  "siteUrl": "{{SP_SITE_URL}}",
  "templateId": "{{TEMPLATE_ID}}",
  "vars": { "code": "{{CODE}}", "name": "{{NAME}}" }
}

# Legacy equivalente:
# POST {{host}}{{urlAdmin}}/apply/sp

################################################################################
# ADMIN · Creación DESDE CERO
################################################################################

### (ACC) Crear proyecto + aplicar plantilla + (opcional) invitar miembro
POST {{host}}{{urlAdmin}}/acc/projects/create
Content-Type: application/json

{
  "hubId": "{{HUB_ID}}",
  "templateId": "{{TEMPLATE_ID}}",
  "vars": { "code": "002", "name": "Proyecto Libreeeee", "type": "Other", "classification": "production" },
  "memberEmail": "support@labit.es",
  "onNameConflict": "suffix-timestamp"
}

### (SP) Crear sitio + aplicar plantilla
POST {{host}}{{urlAdmin}}/sp/sites/create
Content-Type: application/json

{
  "templateId": "{{TEMPLATE_ID}}",
  "vars": { "code": "{{CODE}}", "name": "{{NAME}}" },
  "type": "CommunicationSite",
  "url": "https://{{SPO_TENANT_HOST}}/sites/PRJ-{{CODE}}-{{NAME}}",
  "description": "Sitio del proyecto PRJ-{{CODE}}"
}

### (SP) Crear sitio + aplicar plantilla + asignar miembros
POST {{host}}{{urlAdmin}}/sp/sites/create
Content-Type: application/json

{
  "templateId": "{{TEMPLATE_ID}}",
  "vars": { "code": "{{CODE}}", "name": "{{NAME}}" },
  "type": "CommunicationSite",
  "url": "https://{{SPO_TENANT_HOST}}/sites/PRJ-{{CODE}}-{{NAME}}",
  "description": "Sitio del proyecto PRJ-{{CODE}}",
  "members": [
    { "user": "support@labit.es", "role": "Owner" },
    { "user": "fortega@labit.es", "role": "Member" }
  ]
}


################################################################################
# ADMIN · Twin (ACC <-> SP)
################################################################################

### (Twin) Aplicar sobre ambos (proyecto y sitio YA existentes)
POST {{host}}{{urlAdmin}}/twin/apply
Content-Type: application/json

{
  "twinId": "{{TWIN_ID}}",
  "projectId": "{{PROJECT_ID}}",
  "siteUrl": "{{SP_SITE_URL}}",
  "templateId": "{{TEMPLATE_ID}}",
  "vars": { "code": "{{CODE}}", "name": "{{NAME}}" },
  "accountId": "{{ACC_ACCOUNT_ID}}"
}

### (Twin) Crear ambos desde cero + aplicar + guardar vínculo
POST {{host}}{{urlAdmin}}/twin/create
Content-Type: application/json

{
  "hubId": "{{HUB_ID}}",
  "templateId": "{{TEMPLATE_ID}}",
  "vars": { "code": "{{CODE}}", "name": "{{NAME}}" },
  "sp": {
    "type": "CommunicationSite",
    "url": "https://{{SPO_TENANT_HOST}}/sites/PRJ-{{CODE}}-{{NAME}}"
  },
  "twinId": "{{TWIN_ID}}",
  "memberEmail": "support@labit.es"
}

### (Twin) Estado
GET {{host}}{{urlAdmin}}/twin/{{TWIN_ID}}/status

### (Twin) Listado
GET {{host}}{{urlAdmin}}/twin

################################################################################
# BRIDGE / AUDIT (opcionales rápidos)
################################################################################

### (Bridge) Copia fichero SP → ACC
GET {{host}}{{urlBridge}}/sp-to-acc?driveId={{SP_DRIVE_ID}}&itemId={{SP_ITEM_ID}}&projectId={{PROJECT_ID}}&folderId={{ACC_FOLDER_ID}}&fileName={{NAME}}

### (Bridge) Copia recursiva (dry-run)
POST {{host}}{{urlBridge}}/sp-tree-to-acc?driveId={{SP_DRIVE_ID}}&itemId={{SP_ITEM_ID}}&projectId={{PROJECT_ID}}&folderId={{ACC_FOLDER_ID}}&mode=upsert&dryRun=true

### (Audit) Comparar SP vs ACC desde fecha
GET {{host}}{{urlAudit}}/sp-to-acc?projectId={{PROJECT_ID}}&driveId={{SP_DRIVE_ID}}&itemId={{SP_ITEM_ID}}&accFolderId={{ACC_FOLDER_ID}}&since=2025-09-01T00:00:00Z&mtimePolicy=ignore


################################################################################
# COMPROBACION TEMPORAL DEL ACOUNT ADMIN AAA
################################################################################

### Logout ACC
GET {{host}}/api/oauth/logout

### Verificar token scopes ACC
GET {{host}}/api/oauth/me

### Visivilidad de cuentas ACC
GET {{host}}{{urlAdmin}}/acc/accounts

### Visivilidad de cuentas ACC
GET {{host}}{{urlAdmin}}/acc/accounts/{{ACC_ACCOUNT_ID}}

### GET account details
GET {{host}}{{urlAdmin}}/acc/accounts/{{ACC_ACCOUNT_ID}}/projects


### http://localhost:3000/api/oauth/login?s=data:read,data:write,account:read,account:write
